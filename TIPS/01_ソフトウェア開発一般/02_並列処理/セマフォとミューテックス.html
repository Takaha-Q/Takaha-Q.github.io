<!DOCTYPE html>
<!-- 基準URI -->
<base href="https://takaha-q.github.io/">
<!-- スタイルシート -->
<link rel="stylesheet" href="Sytle001.css" type="text/css">
<!-- スクリプト -->
<!-- タイトル表示 -->
<script src="MakeTitle.js" type="text/javascript"></script>
<!-- 目次表示 -->
<script src="MakeToc_L.js" type="text/javascript"></script>
<!-- ページタイトル(ページ内表示) -->
<span id="title"></span>
<!-- リンク(ホームに戻る) -->
<a href="index.html">ホームに戻る</a>
<!-- 出典・関連ページ -->
<details><summary class=link>出典 :</summary>
<div class=pre><a href="https://ja.wikipedia.org/wiki/%E3%82%BB%E3%83%9E%E3%83%95%E3%82%A9">セマフォ - Wikipedia</a>
</div>
</details>

<!-- 関連ページ -->
<details><summary class=link>関連 :</summary>
<div class=pre><a href="TIPS/01_ソフトウェア開発一般/02_並列処理/タスク(スレッド)間通信.html">タスク(スレッド)間通信</a>
</div>
</details>

<!-- 目次 -->
<h5>目次 :</h5>
<div id="toc"></div>
<hr>
<!-- 本文ここから -->

<h2>セマフォ(Semaphore)とは</h2>
<div class=pre>並列プログラミング(マルチタスク)環境において、プログラムの実行単位(タスク)間で共有する資源へのアクセスを制御する機構。
多くのオペレーティングシステムで提供されている。
各タスクが共有資源へのアクセスを安全に(競合することなく)行うため、
<b>資源への同時アクセスの本数が資源の数を超えないよう制限し、資源(へのアクセス権)に空きが無い場合は、
最後にアクセスしようとしたタスクを空きができるまで待たせる</b>機能を有している。

セマフォ(カウンティングセマフォ)は、有限個の資源へのアクセスをセマフォカウンタによって制御する。
セマフォカウンタの値が、現在アクセス可能な資源の残数を表しており、
資源を獲得する際にカウンタを減算(P操作)、使用後の資源を解放(返却)する際にカウンタを加算(V操作)する。即ち、
</div>

<ol>
<li>資源を獲得する(P操作)</li>
<li>資源を使用する</li>
<li>資源を解放する(V操作)</li>
</ol>

<div class=pre>が、セマフォを使用する際の一連の流れとなる。
<img src="https://raw.githubusercontent.com/Takaha-Q/Takaha-Q.github.io/main/_Img/Software Development/Semaphore_Mutex/development-semaphore-and-mutex_01.png" alt="画像">
管理する資源の個数が 1 のセマフォをバイナリセマフォと呼ぶ。バイナリセマフォは後述のミューテックスと共通の振舞をし、実装に差が無いことも多い。
</div>

<h3>注意すべき点</h3>
<div class=pre>複数の資源に対して使用する(セマフォカウンタの初期値が1を超える)場合、セマフォは単に個数のみを保持する。
即ち、空いている資源のいずれを獲得するかを選択することはできない。
また、セマフォの使用に当たり、以下のような操作は禁忌であり、行うとその資源の使用に際しての公平性・安全性が損なわれ、
プログラムの性能低下・不正動作・フリーズ・クラッシュなどの要因となる。
</div>

<ul>
<li>資源を要求(獲得)しておいて、使用後に解放し忘れる</li>
<li>要求していない資源を使用する</li>
<li>解放済みの資源を使用する</li>
<li>要求したことのない資源を解放する</li>
<li>使用していない資源を長期間獲得したままにする</li>
</ul>

<h2>ミューテックス(Mutex)とは</h2>
<div class=pre>2つの実行単位(タスク)が共用資源にアクセスするのを防止するための機構。
先述の通りバイナリセマフォ(セマフォカウンタのとり得る値が 0 と 1 )と動作上は等価であり、システムによっては実装が同一である。
ただし意味づけには若干の差異があり、ミューテックスが実行単位に結びついているのに対し、セマフォは資源に結びついている。
即ち、ミューテックスは2つの実行単位の排他制御に用いられ(複数の資源を管理することもある)、
(バイナリ)セマフォは一つの資源の排他制御に用いられる(実行単位がいくつあるかは問わない)。
</div>

