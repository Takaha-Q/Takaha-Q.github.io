<!DOCTYPE html>

<!-- 基準URI -->
<base href="https://takaha-q.github.io/">

<!-- スタイルシート -->
<link rel="stylesheet" href="Sytle001.css" type="text/css">

<!-- スクリプト -->
<!-- タイトル表示 -->
<script src="MakeTitle.js" type="text/javascript"></script>

<!-- 目次表示 -->
<script src="MakeToc_L.js" type="text/javascript"></script>

<!-- ページタイトル(ページ内表示) -->
<span id="title"></span>

<!-- リンク(ホームに戻る) -->
<a href="index.html">ホームに戻る</a><br>

<!-- 出典ページ -->
<h5>出典 :</h5>
<a href="https://atmarkit.itmedia.co.jp/ait/articles/1009/07/news096.html">第4回　WPFの「リソース、スタイル、テンプレート」を習得しよう：連載：WPF入門 - ＠IT</a><br>

<!-- 関連ページ -->
<h5>関連 :</h5>
<a href="TIPS/Windows Presentation Foundation(WPF)/[外観]スタイル.html">スタイル</a><br>
<a href="TIPS/Windows Presentation Foundation(WPF)/[外観]テンプレート.html">テンプレート</a><br>
<a href="TIPS/Windows Presentation Foundation(WPF)/Tagプロパティ.html">Tagプロパティ</a><br>

<!-- 目次 -->
<h5>目次 :</h5>
<div id="toc"></div>
<hr>

<!-- 本文ここから -->

<h2>リソースとは</h2>
複数のコントロール(UI要素)でひとつのオブジェクトを共有するための仕組み。<br>
例えば背景色を指定するためのブラシをリソースとして作成しておき、複数の Button で共有するといった使い方ができる。<br>
<a href="TIPS/Windows Presentation Foundation(WPF)/[外観]スタイル.html">スタイル</a>の指定に用いられるのが一般的である。<br>

<h2>リソースの定義</h2>
リソースは( System.Windows.FrameworkElement 型を継承する) Window 等の要素の、Resources プロパティ内に定義する。<br>
この Resources プロパティは ResourceDictionary 型の辞書(連想配列)で、キー、値のいずれもが object 型となっている。<br>
要素の定義(追加)の際は、キーとして使用される <b>x:Key 属性の指定が必須である</b>。

<h5>(XAML)</h5>
<div class="xaml">
&lt;Window x:Class="WpfApplication1.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="MainWindow" Height="100" Width="200"&gt;

    <cmt>&lt;!-- リソース(SolidColorBrush)の定義 --&gt;</cmt>
    <cmt>&lt;!-- キー(x:Key)に <b class="blue">MyBrush</b> を指定 --&gt;</cmt>
    &lt;Window.Resources&gt;
        <b>&lt;SolidColorBrush x:Key="<blue>MyBrush</blue>" Color="Blue"/&gt;</b>
    &lt;/Window.Resources&gt;

    &lt;StackPanel&gt;
        <cmt>&lt;!-- Button にリソースを適用 --&gt;</cmt>
        &lt;Button Content="Button 1"
                Background="<b>{StaticResource ResourceKey=<blue>MyBrush</blue>}</b>"/&gt;
        &lt;Button Content="Button 2"
                Background="<b>{StaticResource ResourceKey=<blue>MyBrush</blue>}</b>"/&gt;
    &lt;/StackPanel&gt;

&lt;/Window&gt;
</div>

ここで "ResourceKey=" は省略可能。以下も同様。

<h5>(表示)</h5>
<img src="https://raw.githubusercontent.com/Takaha-Q/Takaha-Q.github.io/main/_Img/MSVS_DotNet_CSharp/WPF_Resource_Style_Template/01.png" alt=""><br>
ふたつの Button に背景色が設定されている。このとき、生成される Brush はひとつである点に注意。<br>
<br>
通常、ひとつのリソースではひとつのオブジェクトが作成され、複数のコントロールで共有される。<br>
コントロールごとにオブジェクトを作成するよりもオーバーヘッドが削減できる。<br>
尚、コントロールごとに異なるオブジェクトを割り当てることも可能。その場合は x:Shared プロパティを False とする。
<div class="xaml">
    :

    <cmt>&lt;!-- リソース(SolidColorBrush)の定義 --&gt;</cmt>
    <cmt>&lt;!-- (コントロールごとにオブジェクトを作成する) --&gt;</cmt>
    &lt;Window.Resources&gt;
        <b>&lt;SolidColorBrush <b class="red">x:Shared="False"</b> x:Key="MyBrush" Color="Blue"/&gt;</b>
    &lt;/Window.Resources&gt;

    :
</div>

<h2>リソースの参照</h2>
リソースの参照時は、<b>StaticResource または DynamicResource マークアップ拡張を用いる</b>。<br>
<ul>
    <li>StaticResource : 実行時に値を変化させない場合に使用</li>
    <li>DynamicResource : 実行時に値が変化し、その変化を参照元に反映させる場合に使用</li>
</ul>
リソースの検索は、内側(子孫)から外側(祖先)に向かって行われる。<br>
このため、同名のキーを持つリソース・ディクショナリが存在する場合は、<b>より内側にあるリソースが優先される</b>。<br>

<div class="xaml">
&lt;Window x:Class=" WpfApplication1.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"&gt;

    <cmt>&lt;!-- (Window) <b class="red">Brush1</b> 、<b class="red">Brush2</b> の定義 --&gt;</cmt>
    &lt;Window.Resources&gt;
        &lt;SolidColorBrush x:Key="<b class="red">Brush1</b>" Color="Red" /&gt;
        &lt;SolidColorBrush x:Key="<b class="red">Brush2</b>" Color="Red" /&gt;
    &lt;/Window.Resources&gt;

    &lt;StackPanel&gt;
        <cmt>&lt;!-- (StackPanel) <b class="blue">Brush2</b> の定義 --&gt;</cmt>
        &lt;StackPanel.Resources&gt;
            &lt;SolidColorBrush x:Key="<b class="blue">Brush2</b>" Color="Blue" /&gt;
        &lt;/StackPanel.Resources&gt;

        &lt;Button Content="ボタン1"
                Background="{StaticResource ResourceKey=<b class="red">Brush1</b>}"/&gt;

        <cmt>&lt;!-- より内側にある StackPanel の <b class="blue">Brush2</b> を参照する --&gt;</cmt>
        &lt;Button Content="ボタン2"
                Background="{StaticResource ResourceKey=<b class="blue">Brush2</b>}"/&gt;
    &lt;/StackPanel&gt;

&lt;/Window&gt;
</div>

ここでは Window と StackPanel にそれぞれ "Brush2" が定義されているが、「ボタン2」にはより内側にある StackPanel の "Brush2" が適用される。<br>
参照には StaticResource マークアップ拡張を用いている。

<h2>システム・リソース</h2>
オペレーティングシステムで保持している設定(色、フォントなど)をリソース(システム・リソース)として用いることができる。<br>
システム・リソースを利用するには以下のクラスを使用する。<br>
(いずれも名前空間は System.Windows )

<ul>
    <li>SystemColors : システム色やブラシを取得する</li>
    <li>SystemFonts : システム・フォントを取得する</li>
    <li>SystemParameters : ウィンドウの境界線やキャプションの幅などのシステム設定を取得する</li>
</ul>

以下の例では、デスクトップの背景色を使用している。

<div class="xaml">
&lt;Window x:Class="WpfApplication1.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="MainWindow" Width="200" Height="200"&gt;

    &lt;!-- デスクトップの背景色を Grid の背景色として使用 --&gt;
    &lt;Grid Background="{DynamicResource {x:Static SystemColors.DesktopBrushKey}}"&gt;

        :

    &lt;/Grid&gt;

&lt;/Window&gt;
</div>

ここではシステム・リソースの参照に DynamicResource マークアップ拡張を用いている。<br>
これにより、アプリケーション外でデスクトップの背景色が変更されると、即座にその変更がアプリケーションに反映される。<br>
(デスクトップの背景色が変わると、即座に Grid の背景色が変わる。)

<h2>外部リソース</h2>
リソースは ####.Resources タグ中に直接定義する以外に、別途用意したXAMLファイル中に定義したリソースをインポートすることが可能である。<br>
外部リソースのルート要素は <b>ResourceDictionary</b> とし、配下にリソースの各要素を定義する。<br>
Visual Studioで外部リソースを新規作成する場合は、「リソース ディクショナリ(WPF)」を選択する。<br>
(XAMLファイルが新規に作成される。)

<h5>外部リソース(Styles.xaml)</h5>

<div class="xaml">
<bg_lr>&lt;ResourceDictionary</bg_lr>
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"&gt;

    &lt;Style TargetType="Button"&gt;
        &lt;Setter Property="Background" Value="LightBlue" /&gt;
    &lt;/Style&gt;

<bg_lr>&lt;/ResourceDictionary&gt;</bg_lr>
</div>

参照側では ####.Resources タグ配下に ResourceDictionary 要素を記述、Source 属性により参照先を指定する。

<h5>(ウィンドウ)</h5>
<div class="xaml">
&lt;Window x:Class=" WpfApplication1.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"&gt;

    <cmt>&lt;!-- 外部リソース(Style.xaml)をインポート --&gt;</cmt>
    &lt;Window.Resources&gt;
        <bg_ly>&lt;ResourceDictionary Source="Styles.xaml"/&gt;</bg_ly>
    &lt;/Window.Resources&gt;

    &lt;StackPanel&gt;
        <cmt>&lt;!-- インポートしたスタイルが Button に適用される --&gt;</cmt>
        &lt;Button Content="ボタン1"/&gt;
    &lt;/StackPanel&gt;

&lt;/Window&gt;    
</div>

<h2>注意が必要な点</h2>
Windowsアプリケーションにおいてはアセンブリ中に画像などのバイナリファイルを埋め込むための機構が存在し、<br>
これは同様に「リソース(アセンブリ・リソースまたはバイナリ・リソース)」と呼ばれ、WPFでも使用可能である。<br>
当記事で解説する「リソース(オブジェクト・リソース)」との混同に注意すること。
