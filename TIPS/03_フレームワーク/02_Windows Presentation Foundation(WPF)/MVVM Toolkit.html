<!DOCTYPE html>

<!-- 基準URI -->
<base href="https://takaha-q.github.io/">

<!-- スタイルシート -->
<link rel="stylesheet" href="Sytle001.css" type="text/css">

<!-- スクリプト -->
<!-- タイトル表示 -->
<script src="MakeTitle.js" type="text/javascript"></script>

<!-- 目次表示 -->
<script src="MakeToc_L.js" type="text/javascript"></script>

<!-- ページタイトル(ページ内表示) -->
<span id="title"></span>

<!-- リンク(ホームに戻る) -->
<a href="index.html">ホームに戻る</a><br>

<!-- 出典ページ -->
<details><summary class=link>出典 :</summary>
<div class=pre><a href="https://learn.microsoft.com/ja-jp/dotnet/communitytoolkit/mvvm/">MVVM Toolkit の概要 - Community Toolkits for .NET | Microsoft Learn</a>
<a href="https://learn.microsoft.com/ja-jp/dotnet/communitytoolkit/mvvm/generators/observableproperty">ObservableProperty 属性 - Community Toolkits for .NET | Microsoft Learn</a>
<a href="https://qiita.com/hqf00342/items/d12bb669d1ac6fed6ab6">.NET用 MVVM Toolkit v8でMVVMコードを短く #C# - Qiita</a>
<a href="https://qiita.com/hqf00342/items/40a753edd8e37286f996">.NET standard2.x時代のMVVMライブラリ #C# - Qiita</a>
<a href="https://qiita.com/kk-river/items/d974b02f6c4010433a9e">CommunityToolkit.Mvvm V8 入門 #C# - Qiita</a>
<a href="https://zenn.dev/naminodarie/articles/c9617df5ca879f">[C#]WPFでのMVVMについてサンプルアプリからまとめ</a>
<a href="https://shikaku-sh.hatenablog.com/entry/c-sharp-communitytoolkit-mvvm-practice2">C# CommunityToolkit.Mvvm の学習２ ObservableProperty - sh1’s diary</a>
</div></details>

<!-- 関連ページ -->
<details><summary class=link>関連 :</summary>
<div class=pre><a href="TIPS/03_フレームワーク/02_Windows Presentation Foundation(WPF)/MVVMパターン.html">MVVMパターン</a>
<a href="TIPS/03_フレームワーク/02_Windows Presentation Foundation(WPF)/INotifyPropertyChanged.html">INotifyPropertyChanged</a>
<a href="TIPS/03_フレームワーク/02_Windows Presentation Foundation(WPF)/コマンド(ICommand).html">コマンド(ICommand)</a>
<a href="TIPS/03_フレームワーク/02_Windows Presentation Foundation(WPF)/ReactiveProperty.html">ReactiveProperty</a>
<a href="TIPS/02_プログラミング言語/02_CSharp/属性(Attribute).html">[C#]属性(Attribute)</a>
<a href="TIPS/02_プログラミング言語/02_CSharp/partial.html">[C#]partial</a>
</div></details>

<!-- 目次 -->
<h5>目次 :</h5>
<div id=toc></div>
<hr>

<!-- 本文ここから -->

<h2>MVVM Toolkitとは</h2>
<div class=pre>MVVMパターンの構築を支援するライブラリ(フレームワーク)のひとつ。
<code>INotifyPropertyChanged</code>や<code>ICommand</code>を簡単に実装できる。
</div>

<h2>MVVM Toolkitが提供する機能</h2>
<table>
  <tr class=row1>
    <td>提供されるクラス</td>
    <td>名前空間</td>
    <td>担当機能</td>
  </tr>
  <tr>
    <td class=code>ObservableObject</td>
    <td class=code>CommunityToolkit.Mvvm.ComponentModel</td>
    <td><code>INotifyPropertyChanged</code>を実装したオブジェクトの基底クラス</td>
  </tr>
  <tr>
    <td class=code>RelayCommand</td>
    <td class=code>CommunityToolkit.Mvvm.Input</td>
    <td><code>ICommand</code>の実装</td>
  </tr>
  <tr>
    <td class=code>WeakReferenceMessenger</td>
    <td class=code>CommunityToolkit.Mvvm.Messeging</td>
    <td>Messenger (詳細割愛)</td>
  </tr>
  <tr>
    <td class=code>IoC</td>
    <td class=code>CommunityToolkit.Mvvm.DependencyInjection</td>
    <td>DI 、IoC (詳細割愛)</td>
  </tr>
</table>

<h2>準備</h2>
<div class=pre><img src="https://raw.githubusercontent.com/Takaha-Q/Takaha-Q.github.io/main/_Img\WPF\MVVM_Toolkit\08.png" alt="画像">
  CommunityToolkit.Mvvm がインストールされていない場合は、Nuget より取得する。
</div>

<h2>実装例(MVVM Toolkit Ver.8以降)</h2>
<h6>ViewModel : ViewModel.cs</h6>
<div class=pre><img src="https://raw.githubusercontent.com/Takaha-Q/Takaha-Q.github.io/main/_Img\WPF\MVVM_Toolkit\01.png" alt="画像">
</div>

<h6>View : View.xaml</h6>
<div class=pre><img src="https://raw.githubusercontent.com/Takaha-Q/Takaha-Q.github.io/main/_Img\WPF\MVVM_Toolkit\02.png" alt="画像">
</div>

<h6>解説</h6>
<div class=pre>ViewModel は <code>ObservableObject</code> を継承する。
  変更通知プロパティとなるバッキングフィールドには <code>[ObservableProperty]</code> 属性、コマンドには <code>[RelayCommand]</code> 属性を付与する。
  実際にバインドソースとなるプロパティおよびハンドラは、ビルド時に自動生成される。それらの命名規則は下表を参照。
  コード中においても、元の定義名でのアクセスはエラーとなるため、生成されたシンボル名でアクセスする。
</div>

<table>
<tr class="row1">
  <td rowspan="3" class="col1" width="165">変更通知プロパティ</td>
  <td width="165">ViewModel における定義</td>
  <td width="165">生成されるプロパティ</td>
  <td width="165">バインド時に指定するパス</td>
</tr>
<tr>
  <td class="code"><b class="red">n</b>ame<br>(先頭が小文字)</td>
  <td class="code"><b class="red">N</b>ame<b class="blue">Property</b></td>
  <td class="code"><b class="red">N</b>ame</td>
</tr>
<tr>
  <td class="code"><b class="red">_n</b>ame<br>(先頭がアンダースコア + 小文字)</td>
  <td class="code"><b class="red">N</b>ame<b class="blue">Property</b></td>
  <td class="code"><b class="red">N</b>ame</td>
</tr>
</table>

<table>
<tr class="row1">
  <td width="165" rowspan="3" class="col1">コマンド</td>
  <td width="165">ViewModel における定義</td>
  <td width="165">生成されるハンドラ</td>
  <td width="165">バインド時に指定するパス</td>
</tr>
<tr>
  <td class="code">DoSomething()<br>(一般的なメソッド名)</td>
  <td class="code">DoSomething<b class="blue">Command</b>()</td>
  <td class="code">DoSomething<b class="blue">Command</b></td>
</tr>
<tr>
  <td class="code"><b class="red">On</b>DoSomething()<br>(先頭が "On" )</td>
  <td class="code">DoSomething<b class="blue">Command</b>()</td>
  <td class="code">DoSomething<b class="blue">Command</b></td>
</tr>
</table>

<div class=pre>なお、変更通知プロパティの変更直前、直後に処理を行いたい場合は、部分メソッド <code>On####Changing()</code> 、<code>On####Changed()</code> を定義する。
( #### は Property を除くプロパティ名)
</div>

<div class=cs>
<cmt>// バッキングフィールド</cmt>
<knw>[ObservableProperty]</knw>
<kwd>private string</kwd> name;

<cmt>// Name プロパティ( NameProperty )の変更直前処理</cmt>
<kwd>partial void</kwd> OnNameChanging(<kwd>string</kwd> modified)
    =&gt;<knw>Console</knw>.WriteLine(<ltr>$" Name プロパティが </ltr>{modified}<ltr> に変更されようとしています。"</ltr>);

<cmt>// Name プロパティ( NameProperty )の変更直後処理</cmt>
<kwd>partial void</kwd> OnNameChanged(<kwd>string</kwd> modified)
    =&gt;<knw>Console</knw>.WriteLine(<ltr>$" Name プロパティが </ltr>{modified}<ltr> に変更されました。"</ltr>);
</div>

