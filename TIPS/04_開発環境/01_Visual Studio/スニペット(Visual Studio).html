<!DOCTYPE html>

<!-- 基準URI -->
<base href="https://takaha-q.github.io/">

<!-- スタイルシート -->
<link rel="stylesheet" href="Sytle001.css" type="text/css">

<!-- スクリプト -->
<!-- タイトル表示 -->
<script src="MakeTitle.js" type="text/javascript"></script>

<!-- 目次表示 -->
<script src="MakeToc_L.js" type="text/javascript"></script>

<!-- ページタイトル(ページ内表示) -->
<span id="title"></span>

<!-- リンク(ホームに戻る) -->
<a href="index.html">ホームに戻る</a><br>

<!-- 出典ページ -->
<h5>出典 :</h5>
<a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets?view=vs-2022">コード ブロック スニペットを作成して再利用する - Visual Studio (Windows) | Microsoft Learn</a><br>
<a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets-schema-reference?view=vs-2022">コード スニペット スキーマ リファレンス - Visual Studio (Windows) | Microsoft Learn</a><br>
<a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/visual-csharp-code-snippets?view=vs-2022">C# コード スニペット - Visual Studio (Windows) | Microsoft Learn</a><br>
<a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/visual-cpp-code-snippets?view=vs-2022">Visual C++ のコード スニペット - Visual Studio (Windows) | Microsoft Learn</a><br>
<a href="https://qiita.com/IKD-Member/items/550ff4d3ecf1d53b42dc">[VisualStudio] よく書くコードはスニペットにまとめて爆速コーディング - Qiita</a><br>
<a href="https://qiita.com/shirasaya0201/items/4dabb22a8d8ec2729dc6">【VisualStudio】VisualStudioで自作コメント挿入したい #VisualStudio - Qiita</a><br>

<!-- 関連ページ -->
<h5>関連 :</h5>
<a href="TIPS/04_開発環境/04_Visual Studio Code/スニペット(VS Code).html">[VS Code]スニペット</a>

<!-- 目次 -->
<h5>目次 :</h5>
<div id="toc"></div>
<hr>

<!-- 本文ここから -->
<h2>スニペット(コードスニペット)とは</h2>
原義は「切れ端」や「断片」。プログラミングにおいては、再利用できるひとかたまりのコードを表す。<br>
よく使うコードをスニペットとして登録しておくと容易に再利用でき、入力効率が向上する。<br>
また、Visual Studioには予め多数のスニペットが登録されている。

<h2>スニペットの呼び出し(コードへの適用)</h2>
スニペットの展開方法は2種類存在し、呼び出す際の手順が一部異なる。
<ol>
    <li>指定位置への挿入 : キャレットの位置に挿入される<br>
        <img src="https://raw.githubusercontent.com/Takaha-Q/Takaha-Q.github.io/main/_Img/MSVS_DotNet_CSharp/VS_Snippets/11.png"></li>
    <li>ブロックの挿入(C++、C#のみ) : 選択されたコードブロックの周りに追加される<br>
        <img src="https://raw.githubusercontent.com/Takaha-Q/Takaha-Q.github.io/main/_Img/MSVS_DotNet_CSharp/VS_Snippets/12.png"></li>
</ol>

<h3>1. 指定位置への挿入</h3>
<ol>
    <li>スニペットを挿入したい箇所にカーソル(キャレット)を置き、「編集」>「IntelliSense」>「スニペットの挿入」または「ブロックの挿入」を選択する。<br>
        <img src="https://raw.githubusercontent.com/Takaha-Q/Takaha-Q.github.io/main/_Img/MSVS_DotNet_CSharp/VS_Snippets/13.png"><br>
        (ホットキーとして Ctrl + K ⇒ Ctrl + X (スニペット)、Ctrl + K ⇒ Ctrl + S (ブロック)も使用できる。)</li>
    <li>挿入したいスニペットをリストから選択する。</li>
</ol>

<h4>ショートカットを登録している場合</h4>
ユーザ辞書と同様に用いることができる。
<ol>
    <li>スニペットを呼び出したい箇所に<b>登録したショートカットを入力し、Tabキーを2回押す</b>。<br>
        <img src="https://raw.githubusercontent.com/Takaha-Q/Takaha-Q.github.io/main/_Img/MSVS_DotNet_CSharp/VS_Snippets/09.png"></li>
    <li>スニペットが展開される。<br>
        <img src="https://raw.githubusercontent.com/Takaha-Q/Takaha-Q.github.io/main/_Img/MSVS_DotNet_CSharp/VS_Snippets/10.png"></li>
</ol>

<h3>2. ブロックの挿入</h3>
C++、C#以外の言語では使用できない点に注意。
<ol>
    <li>ブロックで囲みたい箇所を選択し、「編集」>「IntelliSense」>「ブロックの挿入」を選択する。
        (または Ctrl + K ⇒ Ctrl + S )</li>
    <li>挿入したいブロックをリストから選択する。</li>
</ol>

<h2>スニペットの新規作成</h2>
スニペットをXML形式で作成し、インポートすることで使用可能となる。

<h3>1. スニペットXMLの作成</h3>

<h4>Visual Studio Snippet Generator(Webサイト)を用いる場合</h4>
機能は限定されるが、スニペットを簡便に作成できる。

<ol>
    <li><a href="http://tools.unitycoder.com/VisualStudioSnippetsGenerator/">Visual Studio Snippet Generator</a>を開く。</li>
    <li>各項目に入力し、"Generate"を押す。<br>
        <img src="https://raw.githubusercontent.com/Takaha-Q/Takaha-Q.github.io/main/_Img/MSVS_DotNet_CSharp/VS_Snippets/02.png"></li>
    <li>下の欄にスニペットが出力されていることを確認したら"Download"を押し、任意のフォルダにファイルをダウンロードする。<br>
        <img src="https://raw.githubusercontent.com/Takaha-Q/Takaha-Q.github.io/main/_Img/MSVS_DotNet_CSharp/VS_Snippets/03.png"></li>
</ol>

<h4>手動で入力する場合</h4>
より複雑で高機能なスニペットを作成することができる。<br>
ただ最初から作成することは手順が煩雑であるため、前項のVisual Studio Snippet Generatorで作成したものを編集するとよい。

<h6>作例</h6>
<img src="https://raw.githubusercontent.com/Takaha-Q/Takaha-Q.github.io/main/_Img/MSVS_DotNet_CSharp/VS_Snippets/14.png"><br>

上記はスニペットを記述したXMLの例である。<br>
まず任意の場所にXMLファイルを作成し、拡張子を <b>.snippet</b> に変更する。<br>
スニペットとして展開したい内容は Code 要素中に記述し、<b>&lt;![CDATA[]]&gt;</b> で囲む。<br>
ここで、リテラル( Literal )として datatype が指定されており、Code 中にも $datatype$ が存在するが、<br>
展開時に、複数ある $datatype$ のうち一つを変更すると、他の $datatype$ も同じ内容に置き換わる。<br>
IDとして指定されたものを含め、$ で囲まれた語句は特殊な働きをし、$end$ (予約語)はスニペット展開後のカーソル位置を示す。<br>
また、Shortcut が設定されているため、"reactive" と入力し、Tabキーを2回押すことでスニペットを呼び出すことができる。<br>
<br>
主要なXMLの要素を以下に記す。すべての項目は<a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets-schema-reference?view=vs-2022">リンク先</a>を参照。

<table>
    <tr class="row1">
        <td class="col1" colspan="6">要素(タグ)</td>
        <td>必須</td>
        <td>説明</td>
        <td>備考</td>
    </tr>
    <tr>
        <td class="col1 left" colspan="6"><a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets-schema-reference?view=vs-2022#codesnippets-element">CodeSnippets</a></td>
        <td></td>
        <td>1つ以上の CodeSnippet 要素のグループ</td>
        <td></td>
    </tr>
    <tr>
        <th class="border_dashed">┗</th><td class="col1 left" colspan="5"><a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets-schema-reference?view=vs-2022#codesnippet-element">CodeSnippet</a></td>
        <td class="center bg_lg">○</td>
        <td>コードスニペットのルート要素</td>
        <td>
            <ul>
                <li>Format 属性が必須(※1)</li>
                <li>CodeSnippets 省略時はルートに記述可能</li>
            </ul>
        </td>
    </tr>
    <tr>
        <th class="border_dashed"></th><th class="border_dashed">┣</th><td class="col1 left" colspan="4"><a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets-schema-reference?view=vs-2022#header-element">Header</a></td>
        <td class="center bg_lg">○</td>
        <td>コードスニペットに関する情報</td>
        <td></td>
    </tr>
    <tr>
        <th class="border_dashed"></th><th class="border_dashed">┃</th><th class="border_dashed">┣</th><td class="col1 left" colspan="3"><a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets-schema-reference?view=vs-2022#title-element">Title</a></td>
        <td class="center bg_lg">○</td>
        <td>コードスニペットの表示名</td>
        <td></td>
    </tr>
    <tr>
        <th class="border_dashed"></th><th class="border_dashed">┃</th><th class="border_dashed">┣</th><td class="col1 left" colspan="3"><a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets-schema-reference?view=vs-2022#author-element">Author</a></td>
        <td></td>
        <td>コードスニペットの作者</td>
        <td></td>
    </tr>
    <tr>
        <th class="border_dashed"></th><th class="border_dashed">┃</th><th class="border_dashed">┣</th><td class="col1 left" colspan="3"><a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets-schema-reference?view=vs-2022#description-element">Description</a></td>
        <td></td>
        <td>コードスニペットの概要</td>
        <td></td>
    </tr>
    <tr>
        <th class="border_dashed"></th><th class="border_dashed">┃</th><th class="border_dashed">┣</th><td class="col1 left" colspan="3"><a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets-schema-reference?view=vs-2022#keywords-element">Keywords</a></td>
        <td></td>
        <td>1つ以上の Keyword 要素のグループ</td>
        <td></td>
    </tr>
    <tr>
        <th class="border_dashed"></th><th class="border_dashed">┃</th><th class="border_dashed">┃</th><th class="border_dashed">┗</th><td class="col1 left" colspan="2"><a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets-schema-reference?view=vs-2022#keyword-element">Keyword</a></td>
        <td></td>
        <td>Visual Studioが検索・分類に用いる<br>カスタムキーワード</td>
        <td>Keywords 省略時はHeader 直下に記述可能</td>
    </tr>
    <tr>
        <th class="border_dashed"></th><th class="border_dashed">┃</th><th class="border_dashed">┣</th><td class="col1 left" colspan="3"><a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets-schema-reference?view=vs-2022#shortcut-element">Shortcut</a></td>
        <td></td>
        <td>コードスニペットを呼び出す際に入力する<br>ショートカットテキスト</td>
        <td>英数字とアンダースコアを使用可能<br>(但しC++はアンダースコアを使用できない)</td>
    </tr>
    <tr>
        <th class="border_dashed"></th><th class="border_dashed">┃</th><th class="border_dashed">┗</th><td class="col1 left" colspan="3"><a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets-schema-reference?view=vs-2022#snippettypes-element">SnippetTypes</a></td>
        <td></td>
        <td>1つ以上の SnippetType 要素のグループ</td>
        <td></td>
    </tr>
    <tr>
        <th class="border_dashed"></th><th class="border_dashed">┃</th><th class="border_dashed"></th><th class="border_dashed">┗</th><td class="col1 left" colspan="2"><a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets-schema-reference?view=vs-2022#snippettype-element">SnippetType</a></td>
        <td></td>
        <td>コードスニペットの挿入方法(値は以下のいずれか)
            <ul>
            <li><b>Expansion</b> : カーソル位置に挿入</li>
            <li><b>SurroundsWith</b> : 選択したコードの周りに配置</li>
            </ul>
        </td>
        <td>SnippetTypes 省略時はHeader 直下に記述可能</td>
    </tr>
    <tr>
        <th class="border_dashed"></th><th class="border_dashed">┗</th><td class="col1 left" colspan="4"><a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets-schema-reference?view=vs-2022#snippet-element">Snippet</a></td>
        <td class="center bg_lg">○</td>
        <td>コードスニペットの本体</td>
        <td></td>
    </tr>
    <tr>
        <th class="border_dashed"></th><th class="border_dashed"></th><th class="border_dashed">┣</th><td class="col1 left" colspan="3"><a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets-schema-reference?view=vs-2022#code-element">Code</a></td>
        <td class="center bg_lg">○</td>
        <td>コードスニペットとして実際に展開されるコード</td>
        <td>
        <ul>
            <li>Language 属性が必須(※2)</li>
            <li>CDATA[] の大括弧の内容が展開される(作例参照)</li>
            <li>$ で囲まれた語句は特殊な働きをする(※3)</li>
        </ul>
        </td>
    </tr>
    <tr>
        <th class="border_dashed"></th><th class="border_dashed"></th><th class="border_dashed">┗</th><td class="col1 left" colspan="3"><a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets-schema-reference?view=vs-2022#declarations-element">Declarations</a></td>
        <td></td>
        <td>コードスニペット中の編集可能要素<br>(リテラルとオブジェクト)</td>
        <td></td>
    </tr>
    <tr>
        <th class="border_dashed"></th><th class="border_dashed"></th><th class="border_dashed"></th><th class="border_dashed">┗</th><td class="col1 left" colspan="2"><a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets-schema-reference?view=vs-2022#literal-element">Literal</a></td>
        <td></td>
        <td>リテラル</td>
        <td></td>
    </tr>
    <tr>
        <th class="border_dashed"></th><th class="border_dashed"></th><th class="border_dashed"></th><th class="border_dashed"></th><th class="border_dashed">┣</th><td class="col1 left"><a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets-schema-reference?view=vs-2022#default-element">Default</a></td>
        <td class="center bg_lg">○</td>
        <td>既定で使用されるリテラル値</td>
        <td></td>
    </tr>
    <tr>
        <th class="border_dashed"></th><th class="border_dashed"></th><th class="border_dashed"></th><th class="border_dashed"></th><th class="border_dashed">┣</th><td class="col1 left"><a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets-schema-reference?view=vs-2022#id-element">Id</a></td>
        <td class="center bg_lg">○</td>
        <td>リテラルの一意な識別子</td>
        <td></td>
    </tr>
    <tr>
        <th class="border_dashed"></th><th class="border_dashed"></th><th class="border_dashed"></th><th class="border_dashed"></th><th class="border_dashed">┣</th><td class="col1 left"><a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets-schema-reference?view=vs-2022#function-element">Function</a></td>
        <td></td>
        <td>リテラルがVisual Studioでフォーカスを受け取った際に<br>実行される関数</td>
        <td></td>
    </tr>
    <tr>
        <th class="border_dashed"></th><th class="border_dashed"></th><th class="border_dashed"></th><th class="border_dashed"></th><th class="border_dashed">┗</th><td class="col1 left"><a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/code-snippets-schema-reference?view=vs-2022#tooltip-element">ToolTip</a></td>
        <td></td>
        <td>リテラルが取り得る値と使用法に関する説明</td>
        <td></td>
    </tr>
</table>

※1 : Format="x.x.x" 形式でスキーマバージョンを指定する。指定が正しくない場合、コードスニペットは無視される。<br>
※2 : Language 属性で指定した言語に対応したファイルでのみ展開可能となる。指定できる値は以下のとおり。

<table>
    <tr class="row1">
        <td class="col1">値</td>
        <td>対応する言語</td>
    </tr>
    <tr>
        <td class="col1">CPP</td>
        <td>C++</td>
    </tr>
    <tr>
        <td class="col1">CSharp</td>
        <td>C#</td>
    </tr>
    <tr>
        <td class="col1">HTML</td>
        <td>HTML</td>
    </tr>
    <tr>
        <td class="col1">JavaScript</td>
        <td>JavaScript</td>
    </tr>
    <tr>
        <td class="col1">SQL</td>
        <td>SQL</td>
    </tr>
    <tr>
        <td class="col1">TypeScript</td>
        <td>TypeScript</td>
    </tr>
    <tr>
        <td class="col1">VB</td>
        <td>Visual Basic</td>
    </tr>
    <tr>
        <td class="col1">XAML</td>
        <td>XAML</td>
    </tr>
    <tr>
        <td class="col1">XML</td>
        <td>XML</td>
    </tr>
</table>

※3 : 以下は予約語で、ひとつのスニペット内に複数回記述できない。それ以外はリテラルまたはオブジェクトとして扱われる。

<table>
    <tr>
        <td class="col1">$end$</td>
        <td>スニペット展開後のカーソル位置を表す</td>
    </tr>
    <tr>
        <td class="col1">$selected$</td>
        <td>選択された範囲を表す(プレースホルダ)</td>
    </tr>
</table>

<h3>2. スニペットのインポート</h3>
<ol>
    <li>Visual Studioを開き、「ツール」&gt;「コード スニペット マネージャー」を選択する。<br>
        <img src="https://raw.githubusercontent.com/Takaha-Q/Takaha-Q.github.io/main/_Img/MSVS_DotNet_CSharp/VS_Snippets/04.png"></li>
    <li>コード スニペット マネージャーが開くので、作成したスニペットを使用する「言語」と、格納する「場所」を選択する。<br>
        (例 : C#で使用する場合は、「言語」に「CSharp」を選択する。)<br>
        <img src="https://raw.githubusercontent.com/Takaha-Q/Takaha-Q.github.io/main/_Img/MSVS_DotNet_CSharp/VS_Snippets/05.png"></li>
    <li>作成したスニペットファイルを選択し、「開く」を押す。<br>
        <img src="https://raw.githubusercontent.com/Takaha-Q/Takaha-Q.github.io/main/_Img/MSVS_DotNet_CSharp/VS_Snippets/06.png"></li>
    <li>「場所」にチェックを入れ、「完了」を押す。<br>
        <img src="https://raw.githubusercontent.com/Takaha-Q/Takaha-Q.github.io/main/_Img/MSVS_DotNet_CSharp/VS_Snippets/07.png"></li>
    <li>「OK」を押すと、スニペットが使用可能となる。<br>
        <img src="https://raw.githubusercontent.com/Takaha-Q/Takaha-Q.github.io/main/_Img/MSVS_DotNet_CSharp/VS_Snippets/08.png"></li>
</ol>
    
<h2>組み込み済のスニペット</h2>
Visual Studioには多数のスニペットが組み込まれており、特殊な手順を経ずに利用できる。ここではその一部を記す。

<h3>C#</h3>
リファレンスは<a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/visual-csharp-code-snippets?view=vs-2022">リンク先</a>を参照。

<table>
    <tr class="row1">
        <td class="col1">スニペット</td>
        <td>概要</td>
        <td>展開される内容</td>
    </tr>
    <tr>
        <td class="col1">prop</td>
        <td>単純なプロパティ<br>(自動プロパティ)</td>
        <td class="code"><kwd>public int</kwd> MyProperty { <kwd>get</kwd>; <kwd>set</kwd>; }</td>
    </tr>
    <tr>
        <td class="col1">propa</td>
        <td>依存関係プロパティ<br>(RegisterAttached())</td>
        <td class="code"><kwd>public static int</kwd> GetMyProperty(<knw>DependencyObject</knw> obj)
{
    <kwd>return</kwd> (<kwd>int</kwd>)obj.GetValue(MyPropertyProperty);
}

<kwd>public static void</kwd> SetMyProperty(<knw>DependencyObject</knw> obj, <kwd>int value</kwd>)
{
    obj.SetValue(MyPropertyProperty, <kwd>value</kwd>);
}

<cmt>// (略)</cmt>
<kwd>public static readonly</kwd> <knw>DependencyProperty</knw> MyPropertyProperty =
<knw>DependencyProperty</knw>.RegisterAttached("MyProperty", <kwd>typeof</kwd>(<kwd>int</kwd>), <kwd>typeof</kwd>(ownerclass), <kwd>new</kwd> <knw>PropertyMetadata</knw>(0));</td>
    </tr>
    <tr>
        <td class="col1">propdp</td>
        <td>依存関係プロパティ<br>(Register())</td>
        <td class="code"><kwd>public int</kwd> MyProperty
{
    <kwd>get</kwd> { <kwd>return</kwd> (<kwd>int</kwd>)GetValue(MyPropertyProperty); }
    <kwd>set</kwd> { SetValue(MyPropertyProperty, <kwd>value</kwd>); }
}

<cmt>// (略)</cmt>
<kwd>public static readonly</kwd> <knw>DependencyProperty</knw> MyPropertyProperty =
<knw>DependencyProperty</knw>.Register("MyProperty", <kwd>typeof</kwd>(<kwd>int</kwd>), <kwd>typeof</kwd>(ownerclass), <kwd>new</kwd> <knw>PropertyMetadata</knw>(0));</td>
   </tr>
    <tr>
        <td class="col1">propfull</td>
        <td>完全なプロパティ<br>
        (フィールドとgetter、setterの組)</td>
        <td class="code"><kwd>private int</kwd> myVar;

<kwd>public int</kwd> MyProperty
{
    <kwd>get</kwd> { <kwd>return</kwd> myVar; }
    <kwd>set</kwd> { myVar = <kwd>value</kwd>; }
}</td>
    </tr>
    <tr>
        <td class="col1">propg</td>
        <td>自動プロパティ<br>(アクセスレベル分離)</td>
        <td class="code"><kwd>public int</kwd> MyProperty { <kwd>get</kwd>; <kwd>private set</kwd>; }</td>
    </tr>
</table>

<h3>C++</h3>
<a href="https://learn.microsoft.com/ja-jp/visualstudio/ide/visual-cpp-code-snippets?view=vs-2022">リファレンス</a>を参照。
