<!DOCTYPE html>

<!-- 基準URI -->
<base href="https://takaha-q.github.io/">

<!-- スタイルシート -->
<link rel="stylesheet" href="Sytle001.css" type="text/css">

<!-- スクリプト -->
<!-- タイトル表示 -->
<script src="MakeTitle.js" type="text/javascript"></script>

<!-- 目次表示 -->
<script src="MakeToc_L.js" type="text/javascript"></script>

<!-- ページタイトル(ページ内表示) -->
<span id="title"></span>

<!-- リンク(ホームに戻る) -->
<a href="index.html">ホームに戻る</a>

<!-- 出典ページ -->
<details><summary class=link>出典 :</summary>
<div class=pre><a href="https://learn.microsoft.com/ja-jp/dotnet/csharp/linq/">C# の統合言語クエリ (LINQ) | Microsoft Learn</a>
<a href="https://qiita.com/nskydiving/items/c9c47c1e48ea365f8995">はじめてのLINQ - Qiita</a>
<a href="https://www.sejuku.net/blog/56519">【C#入門】LINQの使い方総まとめ - Samurai Blog</a>
<a href="https://qiita.com/Marimoiro/items/0e119b47d65bf138789a">LINQチートシート的なもの - Qiita</a>
<a href="https://qiita.com/RyotaMurohoshi/items/ba4ade6c6c9dc40b6217">ListからDictionary作る時もLINQを使おうぜ！ILookupも便利だぜ！ #C# - Qiita</a>
</div></details>

<!-- 関連ページ -->
<details><summary class=link>関連 :</summary>
<div class=pre><a href="TIPS/02_プログラミング言語/02_CSharp/クエリ式(select、from、where).html">クエリ式(select、from、where)</a>
<a href="TIPS/03_フレームワーク/01_dotNET/01_型・クラス/コレクション.html">[.NET]コレクション</a>
<a href="TIPS/01_ソフトウェア開発一般/無名関数とラムダ式.html">無名関数とラムダ式</a>
<a href="TIPS/02_プログラミング言語/02_CSharp/拡張メソッド.html">拡張メソッド</a>
<a href="TIPS/03_フレームワーク/01_dotNET/01_型・クラス/DataTable.html">DataTable</a>
</div></details>

<!-- 目次 -->
<h5>目次 :</h5>
<div id="toc"></div>
<hr>

<!-- 本文ここから -->

<h2>LINQ(Language Integrated Query)とは</h2>
<div class=pre>C# 3.0から導入された、オブジェクト、データベース、XMLなどのデータ集合に対して、クエリ(問い合わせ)を発行できる仕組みのこと。<b>System.Linq</b> 名前空間に属する。
<b>IEnumerable&lt;T&gt;</b> インタフェースを実装するすべてのオブジェクト(配列、コレクションが該当。シーケンスと総称される)に対してLINQが使用できる。
LINQの機能は「クエリ演算子」によって提供され、これらは IEnumerable&lt;T&gt; に対する拡張メソッドとして定義されている。
メソッドの戻り値もまた IEnumerable&lt;T&gt; であるため、メソッドチェーンが有効である。
</div>

<h3>LINQとループの比較</h3>
<div class=cs>
<cmt>// 基となるシーケンス(配列)</cmt>
<kwd>int</kwd>[] seq = {<ltr>1</ltr>, <ltr>2</ltr>, <ltr>3</ltr>, <ltr>4</ltr>, <ltr>5</ltr>, <ltr>6</ltr>, <ltr>7</ltr>, <ltr>8</ltr>};

<cmt>// foreach を用いた場合</cmt>
<kwd>int</kwd>[] mod1 = <kwd>new int</kwd>[seq.Length];
<kwd>int</kwd> i = <ltr>0</ltr>;
<kwd>foreach</kwd>(<kwd>int</kwd> s <kwd>in</kwd> seq)
{
    mod1[i] = s * <ltr>3</ltr>;
}

<cmt>// LINQ( Select() )を用いた場合</cmt>
<kwd>int</kwd>[] mod2 = seq.<b>Select</b>(s =&gt; s * <ltr>3</ltr>).ToArray();
</div>

<div class=pre>上記の例では、配列 seq の各要素に 3 を乗じた配列 mod1 、mod2 を作成しているが、
LINQを用いた場合は foreach を用いる場合と比較してコードが簡潔であり、配列の初期化やインデクスも不要である。
Select() は写像を行うクエリ演算子である。Select() は引数にラムダ式をとるが、ラムダ式の引数( s )はシーケンス(ここでは seq )の各要素である。
ラムダ式の戻り値( => 演算子の右辺である s * 3 )は写像を行った結果新たに作成されるシーケンスの要素となる。
上記の例では seq 、mod1 、mod2 はいずれも同じ型であるが、写像前後で型が異なっていても構わない。
</div>

<h3>クエリ式との比較</h3>
<div class=pre>LINQと同様、<a href="TIPS/02_プログラミング言語/02_CSharp/クエリ式(select、from、where).html">クエリ式</a>でもクエリを実行することができる。
しかしクエリ式はSQLの知識が要求され、記述も煩雑となりがちであるが、LINQはクエリ式の弱点を補うべく開発された経緯から、比較的簡潔に記述できる。
逆にSQLに慣れているのであれば、クエリ式を用いることも選択肢となり得る。
</div>

<h2>実用例</h2>

<h3>コレクションから Dictionary を生成する</h3>
<b>ToDictionary()</b> メソッドを用いる。<br>
<img src="https://raw.githubusercontent.com/Takaha-Q/Takaha-Q.github.io/main/_Img/CSharp/Linq/02.png" alt="画像"><br>
新たに作成する Dictionary のキー、および値それぞれを規定するラムダ式を記述する。<br>
ここで、ラムダ式の引数は基となるコレクションの要素( baseDic の要素である KeyValuePair )である。<br>
KeyValuePair は Key でキー、Value で値を参照できる。<br>
このように、コレクションから Dictionary への転写をループを用いることなく実現できる。<br>
尚、ToDictionary() には複数のオーバーロードが存在する。詳細は割愛。

<h3>グループボックス内のチェックされたラジオボタンを取得する</h3>
<img src="https://raw.githubusercontent.com/Takaha-Q/Takaha-Q.github.io/main/_Img/CSharp/Linq/01.png" alt="画像"><br>
上記例において、groupBox1.Controls は「groupBox1 に含まれるすべてのコントロール」、<br>
OfType&lt;RadioButton&gt;() メソッドにより、「RadioButton」に該当するもののみを抽出している。<br>
ここまでの groupBox1.Controls.OfType&lt;RadioButton&gt;() がLINQの対象シーケンス(集合 : グループボックス内のラジオボタン)となる。<br>
緑線がLINQの提供する Single() メソッドで、ラムダ式を満たす唯一のオブジェクトを結果として返す。<br>

